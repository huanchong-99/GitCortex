# ç»ˆç«¯å¡ä½é—®é¢˜æ ¹æœ¬åŸå› åˆ†ææŠ¥å‘Š

**å®¡è®¡æ—¶é—´**: 2026-02-07
**å®¡è®¡å›¢é˜Ÿ**: code-audit-teamï¼ˆ5åå·¥ç¨‹å¸ˆï¼‰
**é—®é¢˜æè¿°**: å·¥ä½œæµå¯åŠ¨åï¼Œç¬¬ä¸€ä¸ªç»ˆç«¯æ˜¾ç¤º"æ­£å¸¸è¿è¡Œä¸­"ï¼Œä½†å®é™…å¡ä½ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œ10åˆ†é’Ÿæ— æ–‡ä»¶åˆ›å»ºï¼Œç¡®è®¤ä¿¡æ¯æœªä¼ é€’åˆ°ä¸»Agent

---

## æ‰§è¡Œæ‘˜è¦

ç»è¿‡5åä¸“ä¸šå·¥ç¨‹å¸ˆï¼ˆ3ååç«¯ã€2åå…¨æ ˆï¼‰çš„æ·±åº¦ä»£ç å®¡è®¡ï¼Œ**å·²ç¡®è®¤ç»ˆç«¯å¡ä½çš„æ ¹æœ¬åŸå› **ï¼š

### ğŸ”´ æ ¸å¿ƒé—®é¢˜ï¼šç»ˆç«¯çŠ¶æ€æ°¸è¿œå¡åœ¨"waiting"ï¼Œç¼ºå°‘WebSocketäº‹ä»¶é€šçŸ¥

**é—®é¢˜1**: `Terminal::set_started()` æ–¹æ³•å‘½åè¯¯å¯¼ï¼Œå®é™…è®¾ç½®çŠ¶æ€ä¸º"waiting"è€Œé"started"
**é—®é¢˜2**: æ‰€æœ‰çŠ¶æ€æ›´æ–°æ–¹æ³•åªå†™æ•°æ®åº“ï¼Œä»ä¸å‘é€WebSocketäº‹ä»¶
**é—®é¢˜3**: prepareæµç¨‹ä¸­çŠ¶æ€è½¬æ¢é€»è¾‘é”™è¯¯ï¼Œå¯¼è‡´ç»ˆç«¯æ°¸è¿œåœç•™åœ¨"waiting"çŠ¶æ€

---

## æ ¹æœ¬åŸå› è¯¦ç»†åˆ†æ

### 1. ç»ˆç«¯çŠ¶æ€æ°¸è¿œå¡åœ¨"waiting"

**ä½ç½®**: `E:\GitCortex\crates\db\src\models\terminal.rs:471-488`

**é—®é¢˜ä»£ç **:
```rust
pub async fn set_started(pool: &SqlitePool, id: &str) -> sqlx::Result<()> {
    let status = TerminalStatus::Waiting.to_string();  // â† è®¾ç½®ä¸º"waiting"è€Œé"started"
    let now = Utc::now().to_rfc3339();
    sqlx::query("UPDATE terminal SET status = ?, updated_at = ? WHERE id = ?")
        .bind(status)
        .bind(now)
        .bind(id)
        .execute(pool)
        .await?;
    Ok(())
}
```

**é—®é¢˜åˆ†æ**:
- æ–¹æ³•åä¸º`set_started()`ï¼Œæš—ç¤ºåº”è¯¥è®¾ç½®ä¸º"started"çŠ¶æ€
- å®é™…ä»£ç è®¾ç½®ä¸º`TerminalStatus::Waiting`
- è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„å‘½åä¸å®ç°ä¸ä¸€è‡´çš„é—®é¢˜

**è°ƒç”¨è·¯å¾„**:
1. `workflows.rs:prepare_workflow()` â†’ `coordinator.start_terminals_for_workflow()` â†’ ç»ˆç«¯å˜ä¸º"waiting"
2. `workflows.rs:prepare_workflow()` â†’ `launcher.launch_all()` â†’ å†æ¬¡è°ƒç”¨`set_started()` â†’ ä»ç„¶æ˜¯"waiting"
3. **ç»ˆç«¯æ°¸è¿œä¸ä¼šä»"waiting"è½¬æ¢åˆ°"running"æˆ–å…¶ä»–æ´»åŠ¨çŠ¶æ€**

**ä½ç½®**: `E:\GitCortex\crates\services\src\services\orchestrator\terminal_coordinator.rs:79`
```rust
if let Err(e) = Terminal::set_started(&self.db.pool, &terminal.id).await {
    // é”™è¯¯åœ°ä½¿ç”¨äº†set_started()ï¼Œå®é™…è®¾ç½®ä¸º"waiting"
}
```

**ä½ç½®**: `E:\GitCortex\crates\services\src\services\terminal\launcher.rs:346-392`
```rust
// launcher.launch_all()å†…éƒ¨ä¹Ÿè°ƒç”¨set_started()ï¼Œä»ç„¶åªæ˜¯"waiting"
```

---

### 2. ç¼ºå°‘WebSocketäº‹ä»¶é€šçŸ¥

**ä½ç½®**: `E:\GitCortex\crates\db\src\models\terminal.rs:381-395`

**é—®é¢˜ä»£ç **:
```rust
pub async fn update_status(pool: &SqlitePool, id: &str, status: &str) -> sqlx::Result<()> {
    let now = Utc::now().to_rfc3339();
    sqlx::query("UPDATE terminal SET status = ?, updated_at = ? WHERE id = ?")
        .bind(status)
        .bind(now)
        .bind(id)
        .execute(pool)
        .await?;
    Ok(())
    // â† ç¼ºå°‘ï¼šå‘é€ terminal.status_changed äº‹ä»¶
}
```

**é—®é¢˜åˆ†æ**:
- æ‰€æœ‰çŠ¶æ€æ›´æ–°æ–¹æ³•ï¼ˆ`update_status`, `set_started`ï¼‰åªæ›´æ–°æ•°æ®åº“
- **æ²¡æœ‰å‘é€WebSocketäº‹ä»¶é€šçŸ¥å‰ç«¯**
- å‰ç«¯é€šè¿‡`useWorkflowEvents`è®¢é˜…`terminal.status_changed`äº‹ä»¶

**å‰ç«¯è®¢é˜…ä»£ç **: `E:\GitCortex\frontend\src\stores\wsStore.ts:404-408`
```typescript
// å‰ç«¯è®¢é˜…terminal.status_changedäº‹ä»¶
case 'terminal.status_changed':
    // å¤„ç†ç»ˆç«¯çŠ¶æ€å˜åŒ–
```

**ç»“æœ**: å‰ç«¯æ°¸è¿œæ”¶ä¸åˆ°çŠ¶æ€å˜åŒ–é€šçŸ¥ï¼ŒUIä¸€ç›´æ˜¾ç¤º"ç­‰å¾…ç¡®è®¤"

---

### 3. prepareæµç¨‹çŠ¶æ€åŒæ­¥é—®é¢˜

**ä½ç½®**: `E:\GitCortex\crates\server\src\routes\workflows.rs:668-724`

**é—®é¢˜ä»£ç **:
```rust
async fn prepare_workflow(...) {
    // Step 1: è½¬æ¢ç»ˆç«¯ä¸º"waiting"
    coordinator.start_terminals_for_workflow(&workflow_id).await?;

    // Step 3: å¯åŠ¨PTYè¿›ç¨‹
    let launch_results = launcher.launch_all(&workflow_id).await?;

    // Step 5: æ ‡è®°å·¥ä½œæµä¸º"ready"
    Workflow::set_ready(&deployment.db().pool, &workflow_id).await?;
}
```

**é—®é¢˜åˆ†æ**:
- `coordinator`å°†ç»ˆç«¯è®¾ç½®ä¸º"waiting"
- `launcher.launch_all()`å†…éƒ¨å†æ¬¡è°ƒç”¨`set_started()`ï¼Œä»ç„¶æ˜¯"waiting"
- å·¥ä½œæµå˜ä¸º"ready"ï¼Œä½†ç»ˆç«¯æ°¸è¿œåœç•™åœ¨"waiting"
- **å‰ç«¯ç­‰å¾…ç»ˆç«¯çŠ¶æ€å˜åŒ–ï¼Œä½†æ°¸è¿œä¸ä¼šå‘ç”Ÿ**

**çŠ¶æ€è½¬æ¢æµç¨‹æ··ä¹±**:
```
æœŸæœ›æµç¨‹: created â†’ starting â†’ running
å®é™…æµç¨‹: created â†’ waiting â†’ waiting â†’ (å¡ä½)
```

---

## é—®é¢˜ç°è±¡ä¸æ ¹æœ¬åŸå› çš„å¯¹åº”å…³ç³»

| ç”¨æˆ·è§‚å¯Ÿåˆ°çš„ç°è±¡ | æ ¹æœ¬åŸå›  |
|----------------|---------|
| ç»ˆç«¯æ˜¾ç¤º"æ­£å¸¸è¿è¡Œä¸­" | ç»ˆç«¯çŠ¶æ€å¡åœ¨"waiting"ï¼ŒæœªçœŸæ­£å¯åŠ¨ |
| æ²¡æœ‰ä»»ä½•æŠ¥é”™ | ä»£ç é€»è¾‘æ­£å¸¸æ‰§è¡Œï¼Œåªæ˜¯çŠ¶æ€è®¾ç½®é”™è¯¯ |
| ç¡®è®¤ä¿¡æ¯æœªä¼ é€’åˆ°ä¸»Agent | WebSocketäº‹ä»¶æœªå‘é€ï¼Œå‰ç«¯æ— æ³•æ”¶åˆ°çŠ¶æ€æ›´æ–° |
| 10åˆ†é’Ÿæ— æ–‡ä»¶åˆ›å»º | å·¥ä½œæµå®é™…æœªå¯åŠ¨ï¼Œç»ˆç«¯åœç•™åœ¨"waiting"çŠ¶æ€ |
| ç¬¬ä¸€ä¸ªç»ˆç«¯æ˜¾ç¤ºä»åœ¨è¿è¡Œä¸­ | å‰ç«¯UIåŸºäºæ•°æ®åº“çŠ¶æ€æ˜¾ç¤ºï¼Œä½†çŠ¶æ€æœªæ›´æ–° |

---

## Phase 24/25çš„è¡¥å……å‘ç°

### Phase 24: ç»ˆç«¯ä¿¡æ¯ä¼ é€’æœºåˆ¶çš„7ä¸ªæ–­ç‚¹

**å®¡è®¡å·¥ç¨‹å¸ˆ**: backend-engineer-1

å³ä½¿çŠ¶æ€æ­£ç¡®ï¼ŒPromptWatcherä¹Ÿå¯èƒ½å¤±è´¥çš„7ä¸ªæ–­ç‚¹ï¼š

1. **æ³¨å†Œå¤±è´¥é™é»˜åŒ–**: `launcher.rs:355-360` - PromptWatcheræ³¨å†Œå¤±è´¥ä»…è®°å½•è­¦å‘Šï¼Œä¸é˜»å¡å¯åŠ¨
2. **workflow_idè§£æå¤±è´¥**: `launcher.rs:347-391` - æ— æ³•è§£ææ—¶å®Œå…¨è·³è¿‡æ³¨å†Œ
3. **è®¢é˜…è¶…æ—¶**: `prompt_watcher.rs:294-302` - 2ç§’è¶…æ—¶å¯èƒ½ä¸å¤Ÿ
4. **è®¢é˜…æ—¶terminalä¸å­˜åœ¨**: `process.rs:971-981` - æ—¶åºç«äº‰å¯¼è‡´è®¢é˜…å¤±è´¥
5. **is_registered()æ£€æŸ¥è¿‡äºä¸¥æ ¼**: `prompt_watcher.rs:411-416` - éªŒè¯æ—¶æœºé—®é¢˜
6. **æç¤ºæ£€æµ‹å¤±è´¥**: `prompt_watcher.rs:83-106` - CLIè¾“å‡ºæ ¼å¼ä¸åŒ¹é…æˆ–confidenceä¸è¶³
7. **MessageBusè·¯ç”±é—®é¢˜**: `message_bus.rs:194-199` - workflow topicè®¢é˜…é—®é¢˜

**ç»“è®º**: è¿™äº›æ–­ç‚¹æ˜¯æ¬¡è¦é—®é¢˜ï¼Œåªæœ‰åœ¨çŠ¶æ€æ­£ç¡®çš„å‰æä¸‹æ‰ä¼šå½±å“ã€‚å½“å‰ä¸»è¦é—®é¢˜æ˜¯çŠ¶æ€æœ¬èº«å°±é”™è¯¯ã€‚

---

### Phase 25: è‡ªåŠ¨ç¡®è®¤æœºåˆ¶çš„ä¸¥é‡é€»è¾‘ç¼ºé™·

**å®¡è®¡å·¥ç¨‹å¸ˆ**: backend-engineer-2

å‘ç°5ä¸ªé—®é¢˜ï¼ˆ2ä¸ªP0ä¸¥é‡ã€2ä¸ªP1ä¸­ç­‰ã€1ä¸ªP2è½»å¾®ï¼‰ï¼š

#### ğŸ”´ P0ä¸¥é‡é—®é¢˜1ï¼šauto_confirmå­—æ®µä¸PromptWatcheræ³¨å†Œæ— å…³è”

**ä½ç½®**: `launcher.rs:345-374`, `terminals.rs:296-321`

**é—®é¢˜**:
- PromptWatcheræ³¨å†Œé€»è¾‘**æ— æ¡ä»¶æ³¨å†Œ**ï¼Œä¸æ£€æŸ¥`terminal.auto_confirm`å­—æ®µ
- å³ä½¿ç”¨æˆ·è®¾ç½®`autoConfirm=false`ï¼ŒPromptWatcherä»ä¼šæ³¨å†Œå¹¶å¯èƒ½è‡ªåŠ¨å“åº”
- è¿åç”¨æˆ·æ˜ç¡®æ„å›¾ï¼Œå®‰å…¨æ•æ„Ÿåœºæ™¯ä¸‹å¯èƒ½å¯¼è‡´æ„å¤–è‡ªåŠ¨æ“ä½œ

#### ğŸ”´ P0ä¸¥é‡é—®é¢˜2ï¼šPromptHandlerå†³ç­–é€»è¾‘ä¸auto_confirmè„±èŠ‚

**ä½ç½®**: `types.rs:131-143`, `prompt_handler.rs:174-216`

**é—®é¢˜**:
- `TerminalPromptEvent`ç»“æ„ä½“**ä¸åŒ…å«auto_confirmå­—æ®µ**
- `PromptHandler.make_decision()`æ— æ³•çŸ¥é“terminalçš„auto_confirmé…ç½®
- å†³ç­–é€»è¾‘åªåŸºäºpromptç±»å‹å’Œå±é™©å…³é”®è¯ï¼Œæ— æ³•åŒºåˆ†terminalæ˜¯å¦å¯ç”¨äº†auto_confirm
- å³ä½¿terminalè®¾ç½®`auto_confirm=false`ï¼ŒPromptHandlerä»ä¼šè‡ªåŠ¨å†³ç­–

#### ğŸŸ¡ P1ä¸­ç­‰é—®é¢˜3ï¼šå†å²æ•°æ®æœªè¿ç§»

**é—®é¢˜**:
- æ•°æ®åº“è¿ç§»è®¾ç½®`DEFAULT 0`
- Phase 25è®¡åˆ’ä¸­çš„å†å²æ•°æ®è¿ç§»è„šæœ¬ï¼ˆTask 25.3ï¼‰**æœªæ‰¾åˆ°å®ç°**
- ç°æœ‰terminalè®°å½•å¯èƒ½ä»æ˜¯`auto_confirm=0`
- å†å²workflowæ— æ³•äº«å—è‡ªåŠ¨ç¡®è®¤åŠŸèƒ½ï¼Œè¡Œä¸ºä¸ä¸€è‡´

#### ğŸŸ¡ P1ä¸­ç­‰é—®é¢˜4ï¼šPhase 24ä¸Phase 25é›†æˆç¼ºé™·

**é—®é¢˜**:
- Phase 24çš„CLIå‚æ•°ï¼ˆ--yoloï¼‰æ§åˆ¶"CLIå†…éƒ¨è·³è¿‡æƒé™æç¤º"
- Phase 25çš„PromptWatcheræ§åˆ¶"åç«¯æ£€æµ‹å¹¶è‡ªåŠ¨å“åº”PTYè¾“å‡ºæç¤º"
- ä¸¤è€…æ²¡æœ‰ç»Ÿä¸€åè°ƒï¼š
  - å¦‚æœCLIç”¨--yoloè·³è¿‡æç¤ºï¼ŒPromptWatcheræ£€æµ‹ä¸åˆ°æç¤ºï¼ˆCLIä¸è¾“å‡ºï¼‰
  - å¦‚æœCLIä¸ç”¨--yoloï¼ŒPromptWatcherä¼šæ£€æµ‹å¹¶å“åº”ï¼Œä½†è¿™ä¸CLIè¡Œä¸ºé‡å¤
- å¯èƒ½å¯¼è‡´workflowå¡ä½æˆ–è¡Œä¸ºä¸ä¸€è‡´

#### ğŸŸ¢ P2è½»å¾®é—®é¢˜5ï¼šPromptWatcheræ³¨å†Œå¤±è´¥å¤„ç†ä¸å¥å£®

**ä½ç½®**: `launcher.rs:355-360`, `terminals.rs:306-312`

**é—®é¢˜**:
- æ³¨å†Œå¤±è´¥åªè®°å½•warnæ—¥å¿—
- Terminalä»ç„¶å¯åŠ¨ï¼Œä½†è‡ªåŠ¨ç¡®è®¤åŠŸèƒ½é™é»˜å¤±æ•ˆ
- æ²¡æœ‰å‘ç”¨æˆ·æˆ–orchestratoræŠ¥å‘Šæ­¤æ•…éšœ
- ç”¨æˆ·ä¸çŸ¥é“éœ€è¦æ‰‹åŠ¨å“åº”æç¤ºï¼Œè°ƒè¯•å›°éš¾

**ç»“è®º**: Phase 25çš„æ ¸å¿ƒæ¶æ„å·²å®ç°ï¼Œä½†å­˜åœ¨ä¸¥é‡çš„é€»è¾‘ç¼ºé™·ï¼Œå¯¼è‡´auto_confirmå­—æ®µæœªè¢«å®é™…ä½¿ç”¨ã€‚

---

### Phase 26: ç»ˆç«¯è¾“å‡ºæŒä¹…åŒ–çš„6ä¸ªé—®é¢˜

**å®¡è®¡å·¥ç¨‹å¸ˆ**: backend-engineer-3

å‘ç°6ä¸ªé—®é¢˜ï¼ˆ1ä¸ªP0ä¸¥é‡ã€2ä¸ªP1ä¸­ç­‰ã€3ä¸ªP2è½»å¾®ï¼‰ï¼š

**P0ä¸¥é‡é—®é¢˜**: æ‰‹åŠ¨å¯åŠ¨è·¯å¾„çš„loggerå¤±è´¥å¤„ç†ä¸ä¸€è‡´
- ä½ç½®: `terminals.rs:262-274`
- Launcherè·¯å¾„å¤±è´¥ä¼šrollbackï¼Œæ‰‹åŠ¨å¯åŠ¨è·¯å¾„ä»…è­¦å‘Š
- å¯èƒ½å¯¼è‡´ç»ˆç«¯è¿è¡Œä½†è¾“å‡ºæ— æ³•æŒä¹…åŒ–

**P1ä¸­ç­‰é—®é¢˜**:
1. TerminalLoggerçš„flushå¤±è´¥æ¢å¤æœºåˆ¶å­˜åœ¨ç«æ€æ¡ä»¶ (`process.rs:1167-1173`)
2. broadcast channelçš„Laggedé”™è¯¯å¯¼è‡´è¾“å‡ºæ°¸ä¹…ä¸¢å¤± (`process.rs:1036-1041`)

**ç»“è®º**: Phase 26çš„é—®é¢˜ä¸æ˜¯å¯¼è‡´ç»ˆç«¯å¡ä½çš„ç›´æ¥åŸå› ï¼Œä½†ä¼šå½±å“è¾“å‡ºæŒä¹…åŒ–ã€‚

---

## ä¸ºä»€ä¹ˆPhase 24/25æ²¡æœ‰è§£å†³é—®é¢˜ï¼Ÿ

### Phase 24çš„ç›®æ ‡
- å®ç°ç»ˆç«¯è¾“å‡ºæ•è·å’Œä¼ é€’æœºåˆ¶
- å»ºç«‹PromptWatcheræ£€æµ‹æç¤ºç¬¦
- é€šè¿‡MessageBusä¼ é€’ç¡®è®¤è¯·æ±‚

### Phase 25çš„ç›®æ ‡
- å®ç°è‡ªåŠ¨ç¡®è®¤æœºåˆ¶
- æ·»åŠ Codex API fallback
- æé«˜ç¡®è®¤å¯é æ€§

### ä¸ºä»€ä¹ˆæ²¡æœ‰è§£å†³ï¼Ÿ

**Phase 24/25è§£å†³çš„æ˜¯"ä¿¡æ¯ä¼ é€’"é—®é¢˜ï¼Œä½†æ²¡æœ‰è§£å†³"çŠ¶æ€ç®¡ç†"é—®é¢˜**ï¼š

1. Phase 24/25å‡è®¾ç»ˆç«¯å·²ç»æ­£ç¡®å¯åŠ¨å¹¶å¤„äºæ´»åŠ¨çŠ¶æ€
2. å®é™…ä¸Šç»ˆç«¯çŠ¶æ€æ°¸è¿œå¡åœ¨"waiting"ï¼Œæ ¹æœ¬æ²¡æœ‰çœŸæ­£å¯åŠ¨
3. PromptWatcherå³ä½¿æ­£å¸¸å·¥ä½œï¼Œä¹Ÿæ— æ³•æ£€æµ‹åˆ°æç¤ºç¬¦ï¼ˆå› ä¸ºç»ˆç«¯æœªå¯åŠ¨ï¼‰
4. å³ä½¿æ£€æµ‹åˆ°æç¤ºç¬¦ï¼Œå‰ç«¯ä¹Ÿæ”¶ä¸åˆ°é€šçŸ¥ï¼ˆå› ä¸ºç¼ºå°‘WebSocketäº‹ä»¶ï¼‰

**ç±»æ¯”**:
- Phase 24/25 = å»ºç«‹äº†ä¸€æ¡é«˜é€Ÿå…¬è·¯ï¼ˆä¿¡æ¯ä¼ é€’é€šé“ï¼‰
- æ ¹æœ¬é—®é¢˜ = æ±½è½¦æ ¹æœ¬æ²¡æœ‰å¯åŠ¨ï¼ˆç»ˆç«¯çŠ¶æ€é”™è¯¯ï¼‰
- ç»“æœ = é«˜é€Ÿå…¬è·¯å†å¥½ä¹Ÿæ²¡ç”¨ï¼Œå› ä¸ºè½¦æ²¡åŠ¨

---

## å®Œæ•´çš„é—®é¢˜é“¾è·¯

```
ç”¨æˆ·æ‰§è¡Œ: å¯åŠ¨å·¥ä½œæµ
    â†“
workflows.rs:prepare_workflow()
    â†“
coordinator.start_terminals_for_workflow()
    â†“ è°ƒç”¨ Terminal::set_started()
    â†“ å®é™…è®¾ç½®ä¸º TerminalStatus::Waiting
ç»ˆç«¯çŠ¶æ€ = "waiting" (ç¬¬ä¸€æ¬¡)
    â†“
launcher.launch_all()
    â†“ å†æ¬¡è°ƒç”¨ Terminal::set_started()
    â†“ ä»ç„¶è®¾ç½®ä¸º TerminalStatus::Waiting
ç»ˆç«¯çŠ¶æ€ = "waiting" (ç¬¬äºŒæ¬¡)
    â†“
Workflow::set_ready() - å·¥ä½œæµå˜ä¸º"ready"
    â†“
âŒ æ²¡æœ‰å‘é€WebSocketäº‹ä»¶
    â†“
å‰ç«¯: ç­‰å¾… terminal.status_changed äº‹ä»¶
    â†“
âŒ æ°¸è¿œæ”¶ä¸åˆ°äº‹ä»¶
    â†“
å‰ç«¯UI: ä¸€ç›´æ˜¾ç¤º"ç­‰å¾…ç¡®è®¤"
    â†“
ç”¨æˆ·è§‚å¯Ÿ: ç»ˆç«¯å¡ä½ï¼Œ10åˆ†é’Ÿæ— æ–‡ä»¶åˆ›å»º
```

---

## ç»“è®º

### æ ¹æœ¬åŸå› æ€»ç»“

**ç»ˆç«¯å¡ä½çš„æ ¹æœ¬åŸå› æ˜¯çŠ¶æ€ç®¡ç†é”™è¯¯ï¼Œè€Œéä¿¡æ¯ä¼ é€’é—®é¢˜**ï¼š

1. âœ… **çŠ¶æ€è®¾ç½®é”™è¯¯**: `Terminal::set_started()` å®é™…è®¾ç½®ä¸º"waiting"è€Œé"started"
2. âœ… **ç¼ºå°‘äº‹ä»¶é€šçŸ¥**: æ‰€æœ‰çŠ¶æ€æ›´æ–°åªå†™æ•°æ®åº“ï¼Œä¸å‘é€WebSocketäº‹ä»¶
3. âœ… **æµç¨‹é€»è¾‘æ··ä¹±**: prepareæµç¨‹ä¸­å¤šæ¬¡è°ƒç”¨`set_started()`ï¼Œä½†éƒ½åªæ˜¯"waiting"

### ä¸ºä»€ä¹ˆPhase 24/25æ²¡æœ‰è§£å†³ï¼Ÿ

Phase 24/25ä¸“æ³¨äº"ä¿¡æ¯ä¼ é€’"ï¼ˆPromptWatcherã€MessageBusã€è‡ªåŠ¨ç¡®è®¤ï¼‰ï¼Œä½†**æ²¡æœ‰è§¦åŠçŠ¶æ€ç®¡ç†çš„æ ¹æœ¬é—®é¢˜**ã€‚å³ä½¿ä¿¡æ¯ä¼ é€’æœºåˆ¶å®Œç¾ï¼Œç»ˆç«¯çŠ¶æ€é”™è¯¯ä¹Ÿä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹å¡ä½ã€‚

### ä¿®å¤ä¼˜å…ˆçº§

**P0 - ç«‹å³ä¿®å¤**:
1. ä¿®å¤`Terminal::set_started()`çš„çŠ¶æ€è®¾ç½®é€»è¾‘
2. æ·»åŠ WebSocketäº‹ä»¶é€šçŸ¥æœºåˆ¶
3. ä¿®å¤prepareæµç¨‹çš„çŠ¶æ€è½¬æ¢é€»è¾‘

**P1 - çŸ­æœŸä¿®å¤**:
4. ä¿®å¤Phase 24çš„7ä¸ªæ–­ç‚¹ï¼ˆæ³¨å†Œå¤±è´¥å¤„ç†ã€è¶…æ—¶ç­‰ï¼‰
5. ä¿®å¤Phase 26çš„P0/P1é—®é¢˜ï¼ˆloggerå¤±è´¥å¤„ç†ã€Laggedé”™è¯¯ï¼‰

---

## æ·±åº¦åˆ†æï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

### è®¾è®¡ç¼ºé™·çš„æ ¹æº

**1. å‘½åä¸å®ç°ä¸ä¸€è‡´**
- `Terminal::set_started()` æ–¹æ³•åæš—ç¤º"è®¾ç½®ä¸ºå·²å¯åŠ¨"
- å®é™…å®ç°å´æ˜¯"è®¾ç½®ä¸ºç­‰å¾…ä¸­"
- è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘½åè¯¯å¯¼é—®é¢˜ï¼Œå¯¼è‡´è°ƒç”¨è€…è¯¯ç”¨

**2. èŒè´£åˆ†ç¦»ä¸æ¸…**
- æ•°æ®åº“æ¨¡å‹å±‚ï¼ˆ`terminal.rs`ï¼‰è´Ÿè´£çŠ¶æ€æ›´æ–°
- ä½†æ²¡æœ‰è´Ÿè´£äº‹ä»¶é€šçŸ¥çš„èŒè´£
- å¯¼è‡´çŠ¶æ€æ›´æ–°å’Œäº‹ä»¶é€šçŸ¥è„±èŠ‚

**3. çŠ¶æ€æœºè®¾è®¡ç¼ºå¤±**
- ç»ˆç«¯çŠ¶æ€è½¬æ¢æ²¡æœ‰æ˜ç¡®çš„çŠ¶æ€æœº
- å¤šä¸ªåœ°æ–¹éƒ½å¯ä»¥éšæ„è°ƒç”¨`set_started()`
- ç¼ºå°‘çŠ¶æ€è½¬æ¢çš„éªŒè¯å’Œçº¦æŸ

**4. æµ‹è¯•è¦†ç›–ä¸è¶³**
- æ²¡æœ‰ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯å·¥ä½œæµå¯åŠ¨æµç¨‹
- æ²¡æœ‰æµ‹è¯•å‰ç«¯æ˜¯å¦èƒ½æ”¶åˆ°WebSocketäº‹ä»¶
- æ²¡æœ‰æµ‹è¯•ç»ˆç«¯çŠ¶æ€è½¬æ¢çš„å®Œæ•´é“¾è·¯

### ä¸ºä»€ä¹ˆPhase 24/25æ²¡æœ‰å‘ç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

**Phase 24/25çš„å‡è®¾å‰æ**ï¼š
- å‡è®¾ç»ˆç«¯å·²ç»æ­£ç¡®å¯åŠ¨å¹¶å¤„äºæ´»åŠ¨çŠ¶æ€
- å‡è®¾çŠ¶æ€ç®¡ç†æ˜¯æ­£ç¡®çš„
- ä¸“æ³¨äº"ä¿¡æ¯ä¼ é€’"è€Œé"çŠ¶æ€ç®¡ç†"

**å®é™…æƒ…å†µ**ï¼š
- ç»ˆç«¯æ ¹æœ¬æ²¡æœ‰æ­£ç¡®å¯åŠ¨ï¼ˆçŠ¶æ€å¡åœ¨"waiting"ï¼‰
- å³ä½¿PromptWatcheræ­£å¸¸å·¥ä½œï¼Œä¹Ÿæ£€æµ‹ä¸åˆ°æç¤ºç¬¦ï¼ˆå› ä¸ºç»ˆç«¯æœªå¯åŠ¨ï¼‰
- å³ä½¿æ£€æµ‹åˆ°æç¤ºç¬¦ï¼Œå‰ç«¯ä¹Ÿæ”¶ä¸åˆ°é€šçŸ¥ï¼ˆå› ä¸ºç¼ºå°‘WebSocketäº‹ä»¶ï¼‰

**ç±»æ¯”**ï¼š
```
Phase 24/25 = å»ºç«‹äº†ä¸€æ¡é«˜é€Ÿå…¬è·¯ï¼ˆä¿¡æ¯ä¼ é€’é€šé“ï¼‰
æ ¹æœ¬é—®é¢˜ = æ±½è½¦æ ¹æœ¬æ²¡æœ‰å¯åŠ¨ï¼ˆç»ˆç«¯çŠ¶æ€é”™è¯¯ï¼‰
ç»“æœ = é«˜é€Ÿå…¬è·¯å†å¥½ä¹Ÿæ²¡ç”¨ï¼Œå› ä¸ºè½¦æ²¡åŠ¨
```

### é—®é¢˜çš„å½±å“èŒƒå›´

**ç›´æ¥å½±å“**ï¼š
- æ‰€æœ‰é€šè¿‡superpowers-automationå¯åŠ¨çš„å·¥ä½œæµéƒ½ä¼šå¡ä½
- ç”¨æˆ·çœ‹åˆ°ç»ˆç«¯"è¿è¡Œä¸­"ä½†å®é™…æ— ä»»ä½•è¿›å±•
- 10åˆ†é’Ÿåä»æ— æ–‡ä»¶åˆ›å»ºï¼Œç”¨æˆ·å›°æƒ‘

**é—´æ¥å½±å“**ï¼š
- Phase 24/25çš„æ‰€æœ‰æ”¹è¿›éƒ½æ— æ³•ç”Ÿæ•ˆ
- è‡ªåŠ¨ç¡®è®¤æœºåˆ¶æ— æ³•å·¥ä½œ
- ç»ˆç«¯è¾“å‡ºæŒä¹…åŒ–å¯èƒ½å·¥ä½œï¼Œä½†ç»ˆç«¯æœ¬èº«æœªå¯åŠ¨

**ç”¨æˆ·ä½“éªŒ**ï¼š
- è¯¯å¯¼æ€§çš„UIæ˜¾ç¤ºï¼ˆæ˜¾ç¤º"è¿è¡Œä¸­"ä½†å®é™…å¡ä½ï¼‰
- æ²¡æœ‰é”™è¯¯æç¤ºï¼Œç”¨æˆ·æ— æ³•è¯Šæ–­é—®é¢˜
- æµªè´¹å¤§é‡ç­‰å¾…æ—¶é—´

---

## ä¿®å¤å»ºè®®

### P0 - ç«‹å³ä¿®å¤ï¼ˆé˜»å¡æ€§é—®é¢˜ï¼‰

#### 1. ä¿®å¤ `Terminal::set_started()` çš„çŠ¶æ€è®¾ç½®é€»è¾‘

**ä½ç½®**: `E:\GitCortex\crates\db\src\models\terminal.rs:471-488`

**å»ºè®®**ï¼š
- é‡å‘½åä¸º`Terminal::set_waiting()`ä»¥åŒ¹é…å®é™…è¡Œä¸º
- åˆ›å»ºæ–°æ–¹æ³•`Terminal::set_running()`ç”¨äºè®¾ç½®è¿è¡ŒçŠ¶æ€
- åœ¨launcher spawnæˆåŠŸåè°ƒç”¨`set_running()`

#### 2. æ·»åŠ  WebSocket äº‹ä»¶é€šçŸ¥æœºåˆ¶

**ä½ç½®**: `E:\GitCortex\crates\db\src\models\terminal.rs:381-395`

**å»ºè®®**ï¼š
- åœ¨æ‰€æœ‰çŠ¶æ€æ›´æ–°æ–¹æ³•ä¸­æ·»åŠ äº‹ä»¶å‘å¸ƒé€»è¾‘
- ä½¿ç”¨`event_bridge`æˆ–`subscription_hub`å‘é€`terminal.status_changed`äº‹ä»¶
- ç¡®ä¿å‰ç«¯èƒ½å®æ—¶æ”¶åˆ°çŠ¶æ€å˜åŒ–é€šçŸ¥

**ç¤ºä¾‹ä»£ç ç»“æ„**ï¼š
```rust
pub async fn update_status(
    pool: &SqlitePool,
    id: &str,
    status: &str,
    event_publisher: &EventPublisher  // æ·»åŠ äº‹ä»¶å‘å¸ƒå™¨
) -> sqlx::Result<()> {
    // æ›´æ–°æ•°æ®åº“
    sqlx::query("UPDATE terminal SET status = ?, updated_at = ? WHERE id = ?")
        .bind(status)
        .bind(now)
        .bind(id)
        .execute(pool)
        .await?;

    // å‘é€WebSocketäº‹ä»¶
    event_publisher.publish_terminal_status_changed(id, status).await;

    Ok(())
}
```

#### 3. ä¿®å¤ prepare æµç¨‹çš„çŠ¶æ€è½¬æ¢é€»è¾‘

**ä½ç½®**: `E:\GitCortex\crates\server\src\routes\workflows.rs:668-724`

**å»ºè®®**ï¼š
- æ˜ç¡®æ¯ä¸ªé˜¶æ®µçš„çŠ¶æ€è½¬æ¢ï¼šcreated â†’ spawning â†’ running
- coordinatorä¸åº”è¯¥è°ƒç”¨`set_started()`ï¼Œåº”è¯¥ä¿æŒç»ˆç«¯ä¸º"not_started"
- launcheråœ¨spawnæˆåŠŸååº”è¯¥è°ƒç”¨`set_running()`è®¾ç½®ä¸º"running"çŠ¶æ€
- ç¡®ä¿çŠ¶æ€è½¬æ¢çš„åŸå­æ€§å’Œä¸€è‡´æ€§

---

### P1 - çŸ­æœŸä¿®å¤ï¼ˆå½±å“åŠŸèƒ½ä½†ä¸é˜»å¡ï¼‰

#### 4. ä¿®å¤ Phase 24 çš„7ä¸ªæ–­ç‚¹

**ä¼˜å…ˆçº§æ’åº**ï¼š
1. æ³¨å†Œå¤±è´¥åº”é˜»å¡å¯åŠ¨æˆ–æ˜ç¡®æ ‡è®°terminalçŠ¶æ€ï¼ˆP1ï¼‰
2. å»¶é•¿è®¢é˜…è¶…æ—¶ä»2ç§’åˆ°5-10ç§’ï¼ˆP1ï¼‰
3. å¢å¼ºæ—¥å¿—ï¼Œåœ¨æ¯ä¸ªæ–­ç‚¹æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼ˆP2ï¼‰
4. æ·»åŠ å¥åº·æ£€æŸ¥ï¼Œå®šæœŸéªŒè¯PromptWatcheræ´»è·ƒçŠ¶æ€ï¼ˆP2ï¼‰

#### 5. ä¿®å¤ Phase 25 çš„é€»è¾‘ç¼ºé™·

**P0é—®é¢˜**ï¼š
- åœ¨PromptWatcheræ³¨å†Œé€»è¾‘ä¸­æ·»åŠ `auto_confirm`æ£€æŸ¥
- åœ¨`TerminalPromptEvent`ä¸­æ·»åŠ `auto_confirm`å­—æ®µ
- åœ¨`PromptHandler.make_decision()`ä¸­æ£€æŸ¥`auto_confirm`å­—æ®µ

**P1é—®é¢˜**ï¼š
- å®ç°å†å²æ•°æ®è¿ç§»è„šæœ¬
- ç»Ÿä¸€CLIå‚æ•°å’ŒPromptWatcherçš„åè°ƒæœºåˆ¶

#### 6. ä¿®å¤ Phase 26 çš„æŒä¹…åŒ–é—®é¢˜

**P0é—®é¢˜**ï¼š
- ç»Ÿä¸€æ‰‹åŠ¨å¯åŠ¨è·¯å¾„çš„loggerå¤±è´¥å¤„ç†ç­–ç•¥ï¼ˆåº”è¯¥rollbackï¼‰

**P1é—®é¢˜**ï¼š
- ä¿®å¤flushå¤±è´¥æ¢å¤æœºåˆ¶çš„ç«æ€é—®é¢˜
- æ”¹è¿›Laggedé”™è¯¯å¤„ç†ï¼Œè®°å½•ä¸¢å¤±äº‹ä»¶åˆ°æ•°æ®åº“

---

### P2 - é•¿æœŸä¼˜åŒ–ï¼ˆæå‡è´¨é‡ï¼‰

#### 7. æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š
- å·¥ä½œæµå¯åŠ¨ â†’ ç»ˆç«¯çŠ¶æ€è½¬æ¢ â†’ å‰ç«¯æ”¶åˆ°WebSocketäº‹ä»¶
- PromptWatcheræ³¨å†Œ â†’ æ£€æµ‹æç¤ºç¬¦ â†’ è‡ªåŠ¨ç¡®è®¤
- auto_confirm=false â†’ ä¸è‡ªåŠ¨å“åº”
- auto_confirm=true â†’ è‡ªåŠ¨å“åº”

#### 8. å®ç°çŠ¶æ€æœºæ¨¡å¼

**å»ºè®®**ï¼š
- å®šä¹‰æ˜ç¡®çš„çŠ¶æ€è½¬æ¢å›¾
- ä½¿ç”¨çŠ¶æ€æœºåº“ï¼ˆå¦‚`state_machine_future`ï¼‰
- æ·»åŠ çŠ¶æ€è½¬æ¢éªŒè¯å’Œçº¦æŸ
- é˜²æ­¢éæ³•çŠ¶æ€è½¬æ¢

#### 9. æ”¹è¿›å¯è§‚æµ‹æ€§

**å»ºè®®**ï¼š
- æ·»åŠ è¯¦ç»†çš„ç»“æ„åŒ–æ—¥å¿—
- æ·»åŠ Metricsï¼ˆçŠ¶æ€è½¬æ¢æ¬¡æ•°ã€è€—æ—¶ç­‰ï¼‰
- æ·»åŠ Tracingï¼ˆåˆ†å¸ƒå¼è¿½è¸ªï¼‰
- åœ¨å‰ç«¯æ˜¾ç¤ºæ›´è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯

---

## å®¡è®¡å›¢é˜Ÿ

- **team-lead**: åè°ƒå’Œæ•´åˆ
- **backend-engineer-1**: Phase 24ç»ˆç«¯ä¿¡æ¯ä¼ é€’æœºåˆ¶å®¡è®¡ âœ…
- **backend-engineer-2**: Phase 25è‡ªåŠ¨ç¡®è®¤æœºåˆ¶å®¡è®¡ âœ…
- **backend-engineer-3**: Phase 26ç»ˆç«¯è¾“å‡ºæŒä¹…åŒ–å®¡è®¡ âœ…
- **fullstack-engineer-1**: å·¥ä½œæµå¯åŠ¨å’Œç»ˆç«¯ç®¡ç†å®¡è®¡ âœ… â­ **å‘ç°æ ¹æœ¬åŸå› **
- **fullstack-engineer-2**: Agenté—´é€šä¿¡æœºåˆ¶å®¡è®¡ï¼ˆè¿›è¡Œä¸­ï¼‰

---

## å®¡è®¡å®Œæˆåº¦

**å·²å®Œæˆå®¡è®¡** (4/5):
- âœ… Phase 24ç»ˆç«¯ä¿¡æ¯ä¼ é€’æœºåˆ¶ - å‘ç°7ä¸ªæ–­ç‚¹
- âœ… Phase 25è‡ªåŠ¨ç¡®è®¤æœºåˆ¶ - å‘ç°5ä¸ªé—®é¢˜ï¼ˆ2ä¸ªP0ä¸¥é‡ï¼‰
- âœ… Phase 26ç»ˆç«¯è¾“å‡ºæŒä¹…åŒ– - å‘ç°6ä¸ªé—®é¢˜ï¼ˆ1ä¸ªP0ä¸¥é‡ï¼‰
- âœ… å·¥ä½œæµå¯åŠ¨å’Œç»ˆç«¯ç®¡ç† - **å‘ç°æ ¹æœ¬åŸå› **

**è¿›è¡Œä¸­** (1/5):
- ğŸ”„ Agenté—´é€šä¿¡æœºåˆ¶ - ç­‰å¾…fullstack-engineer-2å®Œæˆ

**æ ¹æœ¬åŸå› å·²ç¡®è®¤**ï¼šç»ˆç«¯çŠ¶æ€æ°¸è¿œå¡åœ¨"waiting" + ç¼ºå°‘WebSocketäº‹ä»¶é€šçŸ¥

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-07T13:40:00Z
**æœ€åæ›´æ–°æ—¶é—´**: 2026-02-07T13:40:00Z
**å®¡è®¡çŠ¶æ€**: æ ¹æœ¬åŸå› å·²ç¡®è®¤ï¼Œ4/5å®¡è®¡å·²å®Œæˆï¼Œä¿®å¤å»ºè®®å·²æä¾›

---

## ä»¥ä¸‹ä¸ºå¢é‡åˆå¹¶å†…å®¹ï¼ˆæ¥è‡ª codexåˆ†æé—®é¢˜.mdï¼‰

# Codex å®¡è®¡ç»“è®ºï¼šå·¥ä½œæµé¦–ç»ˆç«¯å¡ä½é—®é¢˜ï¼ˆä»…åŸå› åˆ†æï¼‰

## å®¡è®¡èŒƒå›´ä¸ç»“è®º

- æœ¬æ¬¡é€šè¿‡å¤šåå‰ç«¯/åç«¯/å…¨æ ˆå­ä»£ç†å¹¶è¡Œå®¡è®¡ `E:\GitCortex` å…¨é‡ä»£ç ï¼Œé‡ç‚¹æ ¸æŸ¥ `phase24/phase25` çš„â€œå¾…ç¡®è®¤ä¿¡æ¯ä¼ é€’åˆ°ä¸» Agent ç»ˆç«¯â€é“¾è·¯ã€‚
- **æœ€ç»ˆåŸå› ä¸æ˜¯â€œæ²¡æœ‰åš phase24/phase25â€ï¼Œè€Œæ˜¯â€œç¡®è®¤æ¶ˆæ¯é“¾è·¯åœ¨æ¶ˆè´¹ç«¯æ–­è£‚ + ç­‰å¾…æ€é˜»å¡ä¸é€€å‡ºâ€**ï¼Œå¹¶ä¸”å­˜åœ¨æ—¶åºä¸é»˜è®¤å€¼é—®é¢˜æ”¾å¤§è¯¥ç°è±¡ã€‚

---

## æœ€ç»ˆæ ¹å› ï¼ˆä¸»å› ï¼‰

### 1) åç«¯å·²äº§ç”Ÿâ€œå¾…ç¡®è®¤äº‹ä»¶â€ï¼Œä½†ä¸»ç«¯å‰ç«¯æœªæ­£ç¡®è®¢é˜…/æ¶ˆè´¹è¯¥äº‹ä»¶

`phase24/phase25` å·²åœ¨åç«¯å‘å¸ƒç»ˆç«¯ç¡®è®¤ç›¸å…³äº‹ä»¶ï¼š

- `crates/services/src/services/orchestrator/message_bus.rs:194`ï¼ˆ`publish_terminal_prompt_detected`ï¼‰
- `crates/services/src/services/orchestrator/message_bus.rs:227`ï¼ˆ`publish_terminal_prompt_decision`ï¼‰
- `crates/server/src/routes/workflow_events.rs:63`ï¼ˆ`terminal.prompt_detected` æ˜ å°„ï¼‰
- `crates/server/src/routes/workflow_events.rs:64`ï¼ˆ`terminal.prompt_decision` æ˜ å°„ï¼‰
- `crates/server/src/routes/workflow_events.rs:217`ï¼ˆä»æ¶ˆæ¯æ€»çº¿è½¬ WS äº‹ä»¶ï¼‰

ä½†ä¸»ç«¯å‰ç«¯äº‹ä»¶å±‚æ²¡æœ‰æŠŠè¿™ç±»äº‹ä»¶çº³å…¥æœ‰æ•ˆæ¶ˆè´¹ï¼š

- `frontend/src/stores/wsStore.ts:17`ï¼ˆäº‹ä»¶ç±»å‹å®šä¹‰æœªè¦†ç›– `terminal.prompt_*`ï¼‰
- `frontend/src/stores/wsStore.ts:406`ï¼ˆå·¥ä½œæµäº‹ä»¶è®¢é˜…åˆ—è¡¨æœªåŒ…å« `terminal.prompt_detected/decision`ï¼‰

**ç»“æœï¼šå·¥ä½œç»ˆç«¯å‘å‡ºçš„â€œå¾…ç¡®è®¤ä¿¡æ¯â€å¹¶æœªåœ¨ä¸» Agent ç»ˆç«¯å½¢æˆå¯æ“ä½œç¡®è®¤å…¥å£ã€‚**

---

### 2) åç«¯è¿›å…¥ AskUser åä¸ä¼šè‡ªåŠ¨å›å¡«è¾“å…¥ï¼Œç»ˆç«¯è¿›ç¨‹ä¼šé˜»å¡ç­‰å¾…

- `crates/services/src/services/orchestrator/prompt_handler.rs:106`ï¼ˆ`handle_prompt_event`ï¼‰
- `crates/services/src/services/orchestrator/prompt_handler.rs:133`ï¼ˆ`AskUser` åˆ†æ”¯è¿›å…¥ç­‰å¾…å®¡æ‰¹ï¼‰
- `crates/services/src/services/orchestrator/prompt_handler.rs:300`ï¼ˆç­‰å¾…å®¡æ‰¹æ—¶æ— å¯å›å†™ç»ˆç«¯è¾“å…¥ï¼‰
- `crates/services/src/services/orchestrator/types.rs:291`ï¼ˆç­‰å¾…å®¡æ‰¹æ€ä¸‹ä¸ç»§ç»­å¤„ç†ï¼‰

**ç»“æœï¼šå­ç»ˆç«¯çœ‹èµ·æ¥â€œè¿˜åœ¨è¿è¡Œâ€ï¼Œä½†å®é™…å¡åœ¨äº¤äº’è¾“å…¥ç­‰å¾…ç‚¹ï¼›ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šç»§ç»­äº§ç”Ÿä»£ç å†™å…¥ã€‚**

---

### 3) å‰ç«¯å¯¹ç­‰å¾…å®¡æ‰¹çŠ¶æ€å±•ç¤ºå¼‚å¸¸ï¼Œè¿›ä¸€æ­¥æ©ç›–äº†çœŸå®é˜»å¡ç‚¹

- `frontend/src/pages/WorkflowDebug.tsx:117`ï¼ˆçŠ¶æ€æ˜ å°„æœªè¦†ç›– `waiting_for_approval`ï¼Œä¼šè¢«é™çº§ï¼‰
- `frontend/src/components/workflow/TerminalCard.tsx:7`ï¼ˆçŠ¶æ€è”åˆç±»å‹æœªå®Œæ•´è¦†ç›–ç­‰å¾…å®¡æ‰¹è¯­ä¹‰ï¼‰
- `frontend/src/components/board/TerminalActivityPanel.tsx:23`ï¼ˆæ´»è·ƒè¿‡æ»¤æœªçº³å…¥ `waiting_for_approval`ï¼‰

**ç»“æœï¼šç¬¬ä¸‰è§†è§’çœ‹åˆ°â€œç»ˆç«¯æ— æŠ¥é”™ã€åƒæ­£å¸¸è·‘ç€â€ï¼Œä½†ä¸»ç•Œé¢æ²¡æœ‰æ˜ç¡®æç¤ºâ€œæ­£åœ¨ç­‰ä½ ç¡®è®¤â€ã€‚**

---

## æ”¾å¤§é—®é¢˜çš„è§¦å‘æ¡ä»¶ï¼ˆæ¬¡å› ï¼‰

### A) å¯åŠ¨æ—¶åºå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼ˆå…ˆäº§ç”Ÿå‘½ä»¤äº¤äº’ï¼Œå†å»ºç«‹è®¢é˜…ï¼‰

- `crates/server/src/routes/workflows.rs:703`ã€`crates/server/src/routes/workflows.rs:717`ï¼ˆ`prepare` é˜¶æ®µå·²å¯åŠ¨ç»ˆç«¯ï¼‰
- `crates/server/src/routes/workflows.rs:784`ã€`crates/server/src/routes/workflows.rs:819`ï¼ˆ`start` é˜¶æ®µæ‰å¯åŠ¨ç¼–æ’å™¨è®¢é˜…ï¼‰
- `crates/services/src/services/orchestrator/message_bus.rs:127`ï¼ˆæ— è®¢é˜…è€…æ—¶æ¶ˆæ¯ç›´æ¥ä¸¢å¼ƒï¼‰
- `crates/server/src/routes/event_bridge.rs:61`ï¼ˆä»…æœ‰ WS è®¢é˜…è€…æ—¶æ‰æ¡¥æ¥è½¬å‘ï¼‰

**ç»“æœï¼šè‹¥ç¬¬ä¸€ä¸ªç»ˆç«¯åœ¨è®¢é˜…å»ºç«‹å‰å°±è§¦å‘ç¡®è®¤æç¤ºï¼Œäº‹ä»¶å¯èƒ½ç›´æ¥ä¸¢å¤±ï¼Œä¸»ç«¯æ°¸è¿œä¸çŸ¥é“è¦ç¡®è®¤ã€‚**

### B) `auto_confirm` é»˜è®¤å€¼å†å²ä¸ä¸€è‡´ï¼Œæé«˜äº¤äº’æç¤ºè§¦å‘æ¦‚ç‡

- `crates/db/migrations/20260206000000_add_auto_confirm_to_terminal.sql:8`ï¼ˆDB é»˜è®¤ `auto_confirm=0`ï¼‰
- `crates/db/src/models/terminal.rs:215`ï¼ˆè¯·æ±‚é»˜è®¤å€¼è¯­ä¹‰ä¸º `true`ï¼‰
- `crates/services/src/services/cc_switch.rs:231`ï¼ˆä»… `auto_confirm=true` æ—¶è¿½åŠ è‡ªåŠ¨ç¡®è®¤å‚æ•°ï¼‰

**ç»“æœï¼šå†å²æ•°æ®æˆ–è¿ç§»ä¸ä¸€è‡´åœºæ™¯ä¸‹æ›´å®¹æ˜“è½å…¥â€œéœ€è¦äººå·¥ç¡®è®¤â€çš„äº¤äº’åˆ†æ”¯ï¼Œä»è€Œè§¦å‘ä¸Šè¿°ä¸»å› é“¾è·¯ã€‚**

---

## ä¸ç°è±¡çš„ä¸€ä¸€å¯¹åº”

ä½ æè¿°çš„ç°è±¡ï¼š

- ç¬¬ä¸€ä¸ªç»ˆç«¯æ˜¾ç¤ºåœ¨è¿è¡Œ
- æ²¡æœ‰æŠ¥é”™
- 10 åˆ†é’Ÿæ— æ–°æ–‡ä»¶
- ä¸» Agent ç«¯æ²¡æœ‰å‡ºç°å¯ç¡®è®¤åŠ¨ä½œ

å¯¹åº”ä»£ç è¡Œä¸ºæ˜¯ï¼š

1. ç»ˆç«¯è§¦å‘äº¤äº’æç¤º â†’ åç«¯è¿›å…¥ `AskUser/WaitingForApproval`ï¼›
2. å¾…ç¡®è®¤äº‹ä»¶æ²¡æœ‰è¢«ä¸»ç«¯å‰ç«¯æ­£ç¡®æ¶ˆè´¹ï¼ˆæˆ–åœ¨è®¢é˜…å‰è¢«ä¸¢å¼ƒï¼‰ï¼›
3. æ²¡æœ‰ç¡®è®¤å›ä¼ ï¼Œç»ˆç«¯æŒç»­é˜»å¡ç­‰å¾…è¾“å…¥ï¼›
4. å‰ç«¯çŠ¶æ€å±•ç¤ºåˆæœªå‡†ç¡®æ ‡è¯†â€œç­‰å¾…ç¡®è®¤â€ï¼Œå› æ­¤çœ‹èµ·æ¥åƒâ€œæ­£å¸¸è¿è¡Œä½†å¡ä½â€ã€‚

---

## æœ€ç»ˆä¸€å¥è¯ç»“è®º

**phase24/phase25 çš„â€œæ£€æµ‹ä¸å‘å¸ƒâ€å­˜åœ¨ï¼Œä½†â€œä¸»ç«¯æ¶ˆè´¹ä¸å›ä¼ å†³ç­–â€é“¾è·¯åœ¨å‰ç«¯è®¢é˜…/çŠ¶æ€å‘ˆç°ä¸éƒ¨åˆ†æ—¶åºåœºæ™¯ä¸­æ–­è£‚ï¼Œå¯¼è‡´é¦–ç»ˆç«¯è¿›å…¥ç­‰å¾…ç¡®è®¤åé•¿æœŸé˜»å¡ï¼Œè¡¨è±¡å³æ— æŠ¥é”™æŒç»­è¿è¡Œä¸”æ— äº§å‡ºã€‚**
