#!/bin/bash
set -e

echo "ğŸ” Running pre-commit checks..."

# Check if we're in a worktree or main repo
if [ -f "../.git/commondir" ]; then
    # We're in a worktree, use the main git dir
    GIT_DIR="../$(cat ../.git/commondir)"
else
    GIT_DIR=".git"
fi

# Run cargo check on all targets
cargo check --workspace --all-targets

# Check for compilation errors
if cargo check --workspace 2>&1 | grep -q "^error"; then
    echo "âŒ Cannot commit: compilation errors detected"
    exit 1
fi

echo "âœ… Pre-commit checks passed"
